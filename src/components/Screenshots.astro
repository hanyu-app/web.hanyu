---
const screenshots = [
  { src: '/screenshots/home-screen.webp', alt: 'Home screen with daily progress' },
  { src: '/screenshots/dict-tab-definitions.webp', alt: 'Dictionary definitions view' },
  { src: '/screenshots/write-tab-animation.webp', alt: 'Stroke order animation' },
  { src: '/screenshots/dict-tab-tooltip.webp', alt: 'Interactive word tooltips' },
  { src: '/screenshots/practice-complete.webp', alt: 'Practice results' },
  { src: '/screenshots/dict-tab-examples.webp', alt: 'Example sentences and words' },
];
---

<section class="screenshots" id="screenshots">
  <div class="screenshots-header reveal">
    <div class="container">
      <span class="section-label">Screenshots</span>
      <h2>See Hanyu in action</h2>
    </div>
  </div>

  <div class="scroll-track" id="scroll-track">
    <div class="scroll-inner">
      {screenshots.map((s) => (
        <div class="phone-mockup">
          <img src={s.src} srcset={`/screenshots/small/${s.src.split('/').pop()} 280w, ${s.src} 560w`} sizes="(max-width: 768px) 220px, 280px" alt={s.alt} width="280" height="606" loading="lazy" />
        </div>
      ))}
    </div>
  </div>

  <div class="scroll-indicator container">
    <div class="scroll-indicator-track">
      <div class="scroll-indicator-thumb" id="scroll-thumb"></div>
    </div>
  </div>
</section>

<script>
  const track = document.getElementById('scroll-track');
  const thumb = document.getElementById('scroll-thumb');

  if (track && thumb) {
    const indicator = thumb.parentElement!.parentElement!;

    function updateIndicator() {
      const { clientWidth, scrollWidth, scrollLeft } = track!;
      const maxScroll = scrollWidth - clientWidth;

      if (maxScroll <= 0) {
        indicator.style.display = 'none';
        return;
      }

      indicator.style.display = '';
      const thumbWidth = Math.max((clientWidth / scrollWidth) * 100, 20);
      thumb!.style.width = `${thumbWidth}%`;

      const scrollRatio = scrollLeft / maxScroll;
      const maxThumbTranslate = (100 / thumbWidth) * 100 - 100;
      thumb!.style.transform = `translateX(${scrollRatio * maxThumbTranslate}%)`;
    }

    track.addEventListener('scroll', updateIndicator, { passive: true });
    window.addEventListener('resize', updateIndicator);
    updateIndicator();

    // Mouse wheel â†’ horizontal scroll
    track.addEventListener('wheel', (e) => {
      if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
        e.preventDefault();
        track!.scrollLeft += e.deltaY;
      }
    }, { passive: false });

    // Drag to scroll
    let isDragging = false;
    let startX = 0;
    let startScroll = 0;

    track.addEventListener('mousedown', (e) => {
      isDragging = true;
      startX = e.pageX;
      startScroll = track!.scrollLeft;
      track!.style.cursor = 'grabbing';
      track!.style.userSelect = 'none';
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      const dx = e.pageX - startX;
      track!.scrollLeft = startScroll - dx;
    });

    window.addEventListener('mouseup', () => {
      if (!isDragging) return;
      isDragging = false;
      track!.style.cursor = '';
      track!.style.userSelect = '';
    });
  }
</script>

<style>
  .screenshots {
    padding-top: var(--section-padding);
    padding-bottom: var(--section-padding);
    background-color: var(--color-bg-alt);
    overflow: hidden;
  }

  .screenshots-header {
    text-align: center;
    margin-bottom: 48px;
  }

  .scroll-track {
    position: relative;
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    padding-top: 12px;
    padding-bottom: 8px;
    cursor: grab;
  }

  .scroll-track::-webkit-scrollbar {
    display: none;
  }

  .scroll-inner {
    display: flex;
    gap: 24px;
    padding-inline: max(24px, calc((100vw - 1200px) / 2 + 24px));
    width: max-content;
  }

  .phone-mockup {
    position: relative;
    width: 280px;
    flex-shrink: 0;
    aspect-ratio: 1170 / 2532;
    overflow: hidden;
    border-radius: 2.5rem;
    border: 8px solid #f5f5f5;
    background-color: #f5f5f5;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .phone-mockup:hover {
    transform: translateY(-8px);
  }

  .phone-mockup img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    pointer-events: none;
  }

  .scroll-indicator {
    margin-top: 32px;
  }

  .scroll-indicator-track {
    position: relative;
    max-width: 200px;
    height: 3px;
    background: rgba(0, 0, 0, 0.08);
    border-radius: 2px;
    margin-inline: auto;
  }

  .scroll-indicator-thumb {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: var(--color-text);
    border-radius: 2px;
  }

  @media (max-width: 768px) {
    .phone-mockup {
      width: 220px;
      border-radius: 2rem;
      border-width: 6px;
    }

    .scroll-inner {
      gap: 16px;
    }
  }

  @media (max-width: 480px) {
    .phone-mockup {
      width: 200px;
      border-radius: 1.75rem;
      border-width: 5px;
    }
  }
</style>
